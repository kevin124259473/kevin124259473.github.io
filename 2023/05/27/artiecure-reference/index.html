<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>架构方案汇总 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="架构方案汇总[TOC] 一,基础架构方案 二,大数据架构方案架构设计图 flink配置信息flink-jobmanager123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263apiVersion: apps&#x2F;v1kin">
<meta property="og:type" content="article">
<meta property="og:title" content="架构方案汇总">
<meta property="og:url" content="http://example.com/2023/05/27/artiecure-reference/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="架构方案汇总[TOC] 一,基础架构方案 二,大数据架构方案架构设计图 flink配置信息flink-jobmanager123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263apiVersion: apps&#x2F;v1kin">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/comon.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/flink.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/policy.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/policy-create.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/autheration.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/autheration-code.png">
<meta property="og:image" content="http://example.com/2023/05/27/artiecure-reference/gateway.png">
<meta property="article:published_time" content="2023-05-27T02:12:43.000Z">
<meta property="article:modified_time" content="2024-04-03T03:30:41.821Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/05/27/artiecure-reference/comon.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-artiecure-reference" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/27/artiecure-reference/" class="article-date">
  <time class="dt-published" datetime="2023-05-27T02:12:43.000Z" itemprop="datePublished">2023-05-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/articture/">articture</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      架构方案汇总
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="架构方案汇总"><a href="#架构方案汇总" class="headerlink" title="架构方案汇总"></a>架构方案汇总</h1><p>[TOC]</p>
<h2 id="一-基础架构方案"><a href="#一-基础架构方案" class="headerlink" title="一,基础架构方案"></a>一,基础架构方案</h2><p><img src="/2023/05/27/artiecure-reference/comon.png"></p>
<h2 id="二-大数据架构方案"><a href="#二-大数据架构方案" class="headerlink" title="二,大数据架构方案"></a>二,大数据架构方案</h2><h3 id="架构设计图"><a href="#架构设计图" class="headerlink" title="架构设计图"></a>架构设计图</h3><p><img src="/2023/05/27/artiecure-reference/flink.png"></p>
<h3 id="flink配置信息"><a href="#flink配置信息" class="headerlink" title="flink配置信息"></a>flink配置信息</h3><h5 id="flink-jobmanager"><a href="#flink-jobmanager" class="headerlink" title="flink-jobmanager"></a>flink-jobmanager</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-jobmanager</span><br><span class="line">  namespace: flink</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2 # 通过设置大于 1 的整型值来开启 Standby JobManager</span><br><span class="line">  serviceName: flink-jobmanager</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flink</span><br><span class="line">      component: jobmanager</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: flink</span><br><span class="line">        component: jobmanager</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: jobmanager</span><br><span class="line">          image: harbor.com/library/flink:1.14.5-scala_2.11-java8</span><br><span class="line">          env:</span><br><span class="line">            - name: POD_IP</span><br><span class="line">              valueFrom:</span><br><span class="line">                fieldRef:</span><br><span class="line">                  apiVersion: v1</span><br><span class="line">                  fieldPath: status.podIP</span><br><span class="line">          args: [&quot;jobmanager&quot;, &quot;$(POD_IP)&quot;]</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 6123</span><br><span class="line">              name: rpc</span><br><span class="line">            - containerPort: 6124</span><br><span class="line">              name: blob-server</span><br><span class="line">            - containerPort: 8081</span><br><span class="line">              name: webui</span><br><span class="line">          livenessProbe:</span><br><span class="line">            tcpSocket:</span><br><span class="line">              port: 6123</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            periodSeconds: 60</span><br><span class="line">          resources:</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 1</span><br><span class="line">              memory: 1024Mi</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 1</span><br><span class="line">              memory: 1024Mi            </span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: flink-config-volume</span><br><span class="line">              mountPath: /opt/flink/conf            </span><br><span class="line">          securityContext:</span><br><span class="line">            runAsUser: 0  </span><br><span class="line">      serviceAccountName: flink-service-account </span><br><span class="line">      hostname: flink-jobmanager</span><br><span class="line">      volumes:           </span><br><span class="line">        - name: flink-config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: flink-config</span><br><span class="line">            items:</span><br><span class="line">              - key: flink-conf.yaml</span><br><span class="line">                path: flink-conf.yaml</span><br><span class="line">              - key: log4j-console.properties</span><br><span class="line">                path: log4j-console.properties</span><br></pre></td></tr></table></figure>

<h5 id="flink-taskmanager"><a href="#flink-taskmanager" class="headerlink" title="flink-taskmanager"></a>flink-taskmanager</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-taskmanager</span><br><span class="line">  namespace: flink-k8s</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  serviceName: flink-taskmanager</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flink</span><br><span class="line">      component: taskmanager</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: flink</span><br><span class="line">        component: taskmanager</span><br><span class="line">    spec:       </span><br><span class="line">      containers:</span><br><span class="line">      - name: taskmanager</span><br><span class="line">        image: harbor.com/library/flink:1.14.5-scala_2.11-java8</span><br><span class="line">        args: [&quot;taskmanager&quot;]</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6122</span><br><span class="line">          name: rpc</span><br><span class="line">        - containerPort: 6125</span><br><span class="line">          name: query-state</span><br><span class="line">        livenessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 6122</span><br><span class="line">          initialDelaySeconds: 30</span><br><span class="line">          periodSeconds: 60</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 2</span><br><span class="line">            memory: 5120Mi</span><br><span class="line">          limits:</span><br><span class="line">            cpu: 2</span><br><span class="line">            memory: 5120Mi         </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: flink-config-volume</span><br><span class="line">          mountPath: /opt/flink/conf/           </span><br><span class="line">        securityContext:</span><br><span class="line">          runAsUser: 0</span><br><span class="line">      serviceAccountName: flink-service-account</span><br><span class="line">      hostname: flink-taskmanager	</span><br><span class="line">      volumes:                 </span><br><span class="line">      - name: flink-config-volume</span><br><span class="line">        configMap:</span><br><span class="line">          name: flink-config</span><br><span class="line">          items:</span><br><span class="line">          - key: flink-conf.yaml</span><br><span class="line">            path: flink-conf.yaml</span><br><span class="line">          - key: log4j-console.properties</span><br><span class="line">            path: log4j-console.properties</span><br></pre></td></tr></table></figure>

<h5 id="service-account"><a href="#service-account" class="headerlink" title="service-account"></a>service-account</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">kind: Role</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-k8s-role</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  - &quot;extensions&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - nodes</span><br><span class="line">  - services</span><br><span class="line">  - endpoints</span><br><span class="line">  - namespaces</span><br><span class="line">  - ingresses</span><br><span class="line">  - secrets</span><br><span class="line">  - pods</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  - &quot;extensions&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - events</span><br><span class="line">  - ingresses/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">  - update</span><br><span class="line">  - create</span><br><span class="line">  - patch</span><br><span class="line">  - delete</span><br><span class="line">---</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-service-account</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">secrets:</span><br><span class="line">  - name: flink-service-account-token</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-k8s-minimal</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: flink-k8s-role</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: flink-service-account</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: pvc-flink-data-new</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">  - ReadWriteMany</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 2Gi  </span><br></pre></td></tr></table></figure>

<h5 id="configMap"><a href="#configMap" class="headerlink" title="configMap"></a>configMap</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">  name: flink-config</span><br><span class="line">  labels:</span><br><span class="line">    app: flink</span><br><span class="line">data:</span><br><span class="line">  flink-conf.yaml: |+</span><br><span class="line">    jobmanager.rpc.address: flink-jobmanager</span><br><span class="line">    taskmanager.numberOfTaskSlots: 20</span><br><span class="line">    blob.server.port: 6124</span><br><span class="line">    jobmanager.rpc.port: 6123</span><br><span class="line">    taskmanager.rpc.port: 6122</span><br><span class="line">    queryable-state.proxy.ports: 6125</span><br><span class="line">    taskmanager.heap.size: 5120m</span><br><span class="line">    jobmanager.heap.size: 1024m</span><br><span class="line">    taskmanager.memory.managed.size: 512m</span><br><span class="line">    taskmanager.memory.jvm-metaspace.size: 256m</span><br><span class="line">    taskmanager.memory.jvm-overhead.max: 256m</span><br><span class="line">    taskmanager.memory.network.max: 128m</span><br><span class="line">    env.java.opts:  -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/opt/flink/gc/ -XX:+PrintHeapAtGC  -XX:+PrintGCDetails  -XX:+PrintGCCause -XX:+PrintGCDateStamps  -XX:+PrintGCTimeStamps  -XX:-OmitStackTraceInFastThrow      -Xloggc:/opt/flink/gc/flink-gc-%t.log -XX:+UseGCLogFileRotation  -XX:NumberOfGCLogFiles=14 -XX:GCLogFileSize=100M</span><br><span class="line">    classloader.resolve-order: parent-first</span><br><span class="line">    parallelism.default: 2</span><br><span class="line">    kubernetes.cluster-id: cluster-dev</span><br><span class="line">    kubernetes.namespace: flink-k8s-kafka</span><br><span class="line">    kubernetes.service-account: flink-service-account</span><br><span class="line">    high-availability: org.apache.flink.kubernetes.highavailability.KubernetesHaServicesFactory</span><br><span class="line">    restart-strategy: fixed-delay</span><br><span class="line">    restart-strategy.fixed-delay.attempts: 10</span><br><span class="line">    task.cancellation.timeout: 0</span><br><span class="line">    heartbeat.timeout: 18000000</span><br><span class="line">    taskmanager.registration.timeout: 500min</span><br><span class="line">    akka.tcp.timeout: 18000s</span><br><span class="line">    akka.lookup.timeout: 18000s</span><br><span class="line">    akka.client.timeout: 18000s</span><br><span class="line">    akka.ask.timeout: 18000s</span><br><span class="line">    slot.idle.timeout: 5000000</span><br><span class="line">    slot.request.timeout: 5000000</span><br><span class="line">    s3.ssl.enabled: false</span><br><span class="line">    jobmanager.archive.fs.dir: hdfs://flink-storage/flink-historyserver</span><br><span class="line">    historyserver.web.address: 0.0.0.0</span><br><span class="line">    historyserver.web.port: 8082</span><br><span class="line">    historyserver.archive.fs.dir: hdfs://flink-storage/flink-historyserver</span><br><span class="line">    historyserver.archive.fs.refresh-interval: 10000    </span><br><span class="line">    high-availability.storageDir: hdfs://flink-storage/flink-recover</span><br><span class="line">    # state.backend and state.checkpoints.dir decide real path.</span><br><span class="line">    state.backend: rocksdb</span><br><span class="line">    state.backend.incremental: true</span><br><span class="line">    taskmanager.memory.managed.fraction: 0.3</span><br><span class="line">    state.checkpoints.dir: hdfs://flink-storage/flink-checkpoints</span><br><span class="line">    state.backend.fs.checkpointdir: hdfs://flink-storage/flink-checkpoints</span><br><span class="line">    state.savepoints.dir: hdfs://flink-storage/flink-savepoints</span><br><span class="line">    state.backend.rocksdb.block.blocksize: 64 kb</span><br><span class="line">    state.backend.rocksdb.block.cache-size: 128 mb</span><br><span class="line">    state.backend.rocksdb.files.open :  -1</span><br><span class="line">    state.backend.rocksdb.writebuffer.size : 128 mb</span><br><span class="line">    state.backend.rocksdb.writebuffer.count: 4</span><br><span class="line">    state.backend.rocksdb.writebuffer.number-to-merge: 2</span><br><span class="line">    state.backend.rocksdb.compaction.style: level</span><br><span class="line">    state.backend.rocksdb.thread.num: 4</span><br><span class="line">    state.backend.rocksdb.metrics.block-cache-usage: true</span><br><span class="line">    state.backend.rocksdb.checkpoint.transfer.thread.num: 4</span><br><span class="line">    table.dynamic-table-options.enabled:true</span><br><span class="line">    table.exec.mini-batch.enabled: true</span><br><span class="line">    table.exec.mini-batch.size: 35000</span><br><span class="line">    table.optimizer.distinct-agg.split.enabled: true</span><br><span class="line">    table.exec.mini-batch.allow-latency: 15 s</span><br><span class="line">    execution.checkpointing.interval: 3min</span><br><span class="line">    execution.checkpointing.timeout: 10min</span><br><span class="line">    execution.checkpointing.tolerable-failed-checkpoints: 100</span><br><span class="line">    state.checkpoints.num-retained: 3</span><br><span class="line">    execution.checkpointing.externalized-checkpoint-retention: RETAIN_ON_CANCELLATION</span><br><span class="line">    blob.storage.directory: hdfs://flink-storage/blob    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  log4j-console.properties: |+</span><br><span class="line">    # 如下配置会同时影响用户代码和 Flink 的日志行为</span><br><span class="line">    rootLogger.level = INFO</span><br><span class="line">    rootLogger.appenderRef.console.ref = ConsoleAppender</span><br><span class="line">    rootLogger.appenderRef.rolling.ref = RollingFileAppender</span><br><span class="line"></span><br><span class="line">    # 如果你只想改变 Flink 的日志行为则可以取消如下的注释部分</span><br><span class="line">    #logger.flink.name = org.apache.flink</span><br><span class="line">    #logger.flink.level = INFO</span><br><span class="line"></span><br><span class="line">    # 下面几行将公共 libraries 或 connectors 的日志级别保持在 INFO 级别。</span><br><span class="line">    # root logger 的配置不会覆盖此处配置。</span><br><span class="line">    # 你必须手动修改这里的日志级别。</span><br><span class="line">    logger.akka.name = akka</span><br><span class="line">    logger.akka.level = INFO</span><br><span class="line">    logger.kafka.name= org.apache.kafka</span><br><span class="line">    logger.kafka.level = INFO</span><br><span class="line">    logger.hadoop.name = org.apache.hadoop</span><br><span class="line">    logger.hadoop.level = INFO</span><br><span class="line">    logger.zookeeper.name = org.apache.zookeeper</span><br><span class="line">    logger.zookeeper.level = INFO</span><br><span class="line"></span><br><span class="line">    # 将所有 info 级别的日志输出到 console</span><br><span class="line">    appender.console.name = ConsoleAppender</span><br><span class="line">    appender.console.type = CONSOLE</span><br><span class="line">    appender.console.layout.type = PatternLayout</span><br><span class="line">    appender.console.layout.pattern = %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %-5p %-60c %x - %m%n</span><br><span class="line"></span><br><span class="line">    # 将所有 info 级别的日志输出到指定的 rolling file</span><br><span class="line">    appender.rolling.name = RollingFileAppender</span><br><span class="line">    appender.rolling.type = RollingFile</span><br><span class="line">    appender.rolling.append = false</span><br><span class="line">    appender.rolling.fileName = $&#123;sys:log.file&#125;</span><br><span class="line">    appender.rolling.filePattern = $&#123;sys:log.file&#125;.%i</span><br><span class="line">    appender.rolling.layout.type = PatternLayout</span><br><span class="line">    appender.rolling.layout.pattern = %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %-5p %-60c %x - %m%n</span><br><span class="line">    appender.rolling.policies.type = Policies</span><br><span class="line">    appender.rolling.policies.size.type = SizeBasedTriggeringPolicy</span><br><span class="line">    appender.rolling.policies.size.size=100MB</span><br><span class="line">    appender.rolling.strategy.type = DefaultRolloverStrategy</span><br><span class="line">    appender.rolling.strategy.max = 10</span><br><span class="line"></span><br><span class="line">    # 关闭 Netty channel handler 中不相关的（错误）警告</span><br><span class="line">    logger.netty.name = org.jboss.netty.channel.DefaultChannelPipeline</span><br><span class="line">    logger.netty.level = OFF</span><br></pre></td></tr></table></figure>

<p>flink-service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-jobmanager</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  ports:</span><br><span class="line">  - name: rpc</span><br><span class="line">    port: 6123</span><br><span class="line">  - name: blob-server</span><br><span class="line">    port: 6124</span><br><span class="line">  - name: webui</span><br><span class="line">    port: 8081</span><br><span class="line">  selector:</span><br><span class="line">    app: flink</span><br><span class="line">    component: jobmanager</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-jobmanager-rest</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - name: rest</span><br><span class="line">    port: 8081</span><br><span class="line">    targetPort: 8081</span><br><span class="line">    nodePort: 30002</span><br><span class="line">  selector:</span><br><span class="line">    app: flink</span><br><span class="line">    component: jobmanager   </span><br></pre></td></tr></table></figure>

<h5 id="flink-history"><a href="#flink-history" class="headerlink" title="flink-history"></a>flink-history</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-job-historyserver</span><br><span class="line">  namespace: flink</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: flink</span><br><span class="line">    component: flink-job-historyserver</span><br><span class="line">  type: NodePort  </span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 8082</span><br><span class="line">      targetPort: 8082</span><br><span class="line">      nodePort: 31084</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: flink-job-historyserver</span><br><span class="line">  namespace: flink-k8s-kafka</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  serviceName: flink-job-historyserver</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flink</span><br><span class="line">      component: flink-job-historyserver</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: flink</span><br><span class="line">        component: flink-job-historyserver</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: flink-job-historyserver</span><br><span class="line">          image: harbor.com/library/flink:1.14.5-scala_2.11-java8</span><br><span class="line">          command: [&quot;/opt/flink/bin/historyserver.sh&quot;,&quot;start-foreground&quot;]</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8082</span><br><span class="line">              name: webui</span><br><span class="line">          resources:</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 0.5</span><br><span class="line">              memory: 512Mi</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 0.5</span><br><span class="line">              memory: 512Mi              </span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: flink-config-volume</span><br><span class="line">              mountPath: /opt/flink/conf             </span><br><span class="line">          securityContext:</span><br><span class="line">            runAsUser: 0  </span><br><span class="line">      serviceAccountName: flink-service-account</span><br><span class="line">      hostname: flink-job-historyserver</span><br><span class="line">      volumes:         </span><br><span class="line">        - name: flink-config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: flink-config</span><br><span class="line">            items:</span><br><span class="line">              - key: flink-conf.yaml</span><br><span class="line">                path: flink-conf.yaml</span><br><span class="line">              - key: log4j-console.properties</span><br><span class="line">                path: log4j-console.properties</span><br></pre></td></tr></table></figure>



<h2 id="三-认证授权相关方案"><a href="#三-认证授权相关方案" class="headerlink" title="三,认证授权相关方案"></a>三,认证授权相关方案</h2><h3 id="基于PBAC的认证权限系统设计"><a href="#基于PBAC的认证权限系统设计" class="headerlink" title="基于PBAC的认证权限系统设计"></a>基于PBAC的认证权限系统设计</h3><h4 id="核心模型"><a href="#核心模型" class="headerlink" title="核心模型"></a>核心模型</h4><p><img src="/2023/05/27/artiecure-reference/policy.png"></p>
<p>举例</p>
<p><img src="/2023/05/27/artiecure-reference/policy-create.png"></p>
<h4 id="核心流程"><a href="#核心流程" class="headerlink" title="核心流程"></a>核心流程</h4><h5 id="授权验证流程"><a href="#授权验证流程" class="headerlink" title="授权验证流程"></a>授权验证流程</h5><p><img src="/2023/05/27/artiecure-reference/autheration.png"></p>
<h5 id="权限认证代码流程"><a href="#权限认证代码流程" class="headerlink" title="权限认证代码流程"></a>权限认证代码流程</h5><p><img src="/2023/05/27/artiecure-reference/autheration-code.png"></p>
<h3 id="招聘要求"><a href="#招聘要求" class="headerlink" title="招聘要求"></a>招聘要求</h3><p>SSO架构师</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【工作职责】</span><br><span class="line">1. 负责设计ESSO解决方案，涉及网络认证、身份认证、桌面认证等；</span><br><span class="line">2. 负责ESSO核心代码编写，核心技术攻关，解决项目中遇到的技术问题</span><br><span class="line">【任职要求】</span><br><span class="line">1. 统招本科及以上学历，4年以上企业单点认证（ESSO）业务设计开发经验；</span><br><span class="line">2. 精通ESSO，熟悉身份认证、网络认证与桌面认证；</span><br><span class="line">3. 具备DDD领域建模能力，具备DDD产品实践；</span><br><span class="line">4. 精通Java技术栈，掌握基础数据结构、算法和设计模式并熟练应用，精通UML图；理解系统设计常用原则、方法论与工具；</span><br><span class="line">5. 熟悉SQL与NoSQL，熟悉多线程编程，具备大并发业务处理经验。</span><br></pre></td></tr></table></figure>

<p>企业单点认证（ESSO）架构师</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【工作职责】</span><br><span class="line">负责设计ESSO解决方案，涉及网络认证、身份认证、桌面认证等；</span><br><span class="line">负责ESSO核心代码编写，核心技术攻关，解决项目中遇到的技术问题</span><br><span class="line">【任职要求】</span><br><span class="line">统招本科及以上学历，4年以上企业单点认证（ESSO）业务设计开发经验；</span><br><span class="line">精通ESSO，熟悉身份认证、网络认证与桌面认证；</span><br><span class="line">具备DDD领域建模能力，具备DDD产品实践；</span><br><span class="line">精通Java技术栈，掌握基础数据结构、算法和设计模式并熟练应用，精通UML图；理解系统设计常用原则、方法论与工具；</span><br><span class="line">熟悉SQL与NoSQL，熟悉多线程编程，具备大并发业务处理经验。</span><br></pre></td></tr></table></figure>

<p>策略引擎架构师</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">【工作职责】</span><br><span class="line">1、负责IAM产品认证引擎或授权策略部分核心模块的实现，建设通用、可靠、安全、灵活的策略引擎；</span><br><span class="line">2、主导IAM产品认证或授权的策略引擎顶层设计与领域建模（自适应认证（Adaptive Engine），策略引擎，策略冲突，策略决策）；</span><br><span class="line">【任职要求】</span><br><span class="line">1、统招本科及以上学历，6-10年工作经验（具备自适应引擎、授权平台策略引擎设计优先）；</span><br><span class="line">2、具备DDD领域建模能力，具备DDD产品实践；</span><br><span class="line">3、具备策略引擎开发经验：策略冲突柔性解决，策略引擎决策，策略管理（可视化策略控制及策略执行）</span><br><span class="line">4、掌握基础数据结构、算法和设计模式并熟练应用，精通UML图；理解系统设计常用原则、方法论与工具。</span><br></pre></td></tr></table></figure>

<p>认证授权业务总架构师</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">【工作职责】</span><br><span class="line">制定IAM产品认证授权业务架构与技术架构，制定认证授权专业能力发展规划；</span><br><span class="line">负责指导工程师进行技术验证和实现，核心代码编写，核心技术攻关，解决项目中遇到的技术问题</span><br><span class="line">【任职要求】</span><br><span class="line">6年以上认证授权平台设计经验：</span><br><span class="line">熟悉RBAC，ABAC，PBAC设计模型并实践于产品或项目中；</span><br><span class="line">精通自适应认证、企业SSO、认证编排、认证集成、MFA；</span><br><span class="line">具备认证授权建模经验。</span><br><span class="line">具备高性能，无侵入认证、授权组件设计经验；</span><br><span class="line">精通策略引擎（业务架构设计和技术架构设计）。</span><br></pre></td></tr></table></figure>



<h2 id="四-网关平台方案"><a href="#四-网关平台方案" class="headerlink" title="四,网关平台方案"></a>四,网关平台方案</h2><p><img src="/2023/05/27/artiecure-reference/gateway.png"></p>
<h2 id="五-Redis搭建方案"><a href="#五-Redis搭建方案" class="headerlink" title="五,Redis搭建方案"></a>五,Redis搭建方案</h2><h3 id="哨兵方案"><a href="#哨兵方案" class="headerlink" title="哨兵方案"></a>哨兵方案</h3><p>一主两从三哨兵,详细配置如下</p>
<p>master.conf配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">port 6379</span><br><span class="line">tcp-backlog 511</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 0</span><br><span class="line">loglevel notice</span><br><span class="line">logfile /var/log/redis_6379.log</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line">requirepass AAAaaa1234</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>slave1.conf配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">port 16379</span><br><span class="line">tcp-backlog 511</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 0</span><br><span class="line">loglevel notice</span><br><span class="line">logfile /var/log/redis_16379.log</span><br><span class="line">databases 16</span><br><span class="line">slaveof 172.6.9.141 6379</span><br><span class="line">requirepass AAAaaa1234</span><br><span class="line">masterauth AAAaaa1234</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>slave2.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">port 26379</span><br><span class="line">tcp-backlog 511</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 0</span><br><span class="line">loglevel notice</span><br><span class="line">logfile /var/log/redis_16379.log</span><br><span class="line">databases 16</span><br><span class="line">slaveof 172.16.9.141 6379</span><br><span class="line">masterauth AAAaaa1234</span><br><span class="line">requirepass AAAaaa1234</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sentinel1.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">port 6380</span><br><span class="line">daemonize yes</span><br><span class="line">sentinel myid 8947f009cfb83e035adb22526205d667aae1175d</span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br><span class="line">sentinel monitor mymaster 172.6.9.141 6379 2</span><br><span class="line">sentinel auth-pass mymaster AAAaaa1234</span><br><span class="line">sentinel down-after-milliseconds mymaster 3000</span><br><span class="line"># Generated by CONFIG REWRITE</span><br><span class="line">dir &quot;/root/redis&quot;</span><br><span class="line">protected-mode no</span><br><span class="line">sentinel config-epoch mymaster 0</span><br><span class="line">sentinel leader-epoch mymaster 0</span><br><span class="line">sentinel known-replica mymaster 172.6.9.141 26379</span><br><span class="line">sentinel known-replica mymaster 172.6.9.141 16379</span><br><span class="line">sentinel current-epoch 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sentinel2.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port 16380</span><br><span class="line">daemonize yes</span><br><span class="line">sentinel myid e92b5cc6e5234e695daee6058e786c72a220945c</span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br><span class="line">sentinel monitor slave1 172.6.9.141 16379 2</span><br><span class="line">sentinel down-after-milliseconds slave1 3000</span><br><span class="line">sentinel auth-pass slave1 AAAaaa1234</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sentinel3.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">port 26380</span><br><span class="line">daemonize yes</span><br><span class="line">sentinel myid 053740df367aaf818553ce1f804265240c4d2234</span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br><span class="line">sentinel monitor slave2 172.16.9.141 26379 2</span><br><span class="line">sentinel down-after-milliseconds slave2 3000</span><br><span class="line">sentinel auth-pass slave2 AAAaaa1234</span><br></pre></td></tr></table></figure>

<p>执行脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash</span><br><span class="line">./redis-server master.conf &amp;</span><br><span class="line">./redis-server slave1.conf &amp;</span><br><span class="line">./redis-server slave2.conf &amp;</span><br><span class="line">./redis-sentinel sentinel1.conf &amp;</span><br><span class="line">./redis-sentinel sentinel2.conf &amp;</span><br><span class="line">./redis-sentinel sentinel3.conf &amp;</span><br></pre></td></tr></table></figure>

<h2 id="六-零信任产品架构设计"><a href="#六-零信任产品架构设计" class="headerlink" title="六, 零信任产品架构设计"></a>六, 零信任产品架构设计</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1）统一安全接入</span><br><span class="line">安全网关默认“拒绝一切（deny all）”连接，只会接收客户端发来的第一个带身份信息的包。 安全网关验证通过后，才会允许建立连接。SPA 和动态端口技术保证了黑客无法检测到安全网关开放的端口，无法对深云安全网关进行扫描。</span><br><span class="line">（2）统一认证服务</span><br><span class="line">用户名口令认证、LDAP认证、PKI（USB-KEY）认证、二维码认证、OTP（动态口令）认证、互联网快捷认证（QQ/微信/钉钉等）、生物特征认证、第三方认证。</span><br><span class="line">（3）统一权限管理</span><br><span class="line">支持用户角色权限、组织权限等多种资源授权体系，支持横向、纵向数据授权模式。</span><br><span class="line">（4）统一应用集成</span><br><span class="line">在线集成指引在线接入文档、在线接入、在线调试等，服务（应用）单点集成，支持CAS CLIENT、OAUTH2.0、SAML2.0、RESTFUL API、FORMBASE等。</span><br><span class="line">（5）统一用户管理</span><br><span class="line">用户类型管理，人员信息同步，账号全生命周期管理，角色管理，权限管理，组织管理，账号和密码安全策略。</span><br><span class="line">（6）统一审计管理</span><br><span class="line">用户管理行为审计、用户访问行为审计、审计报表。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="核心技术分析"><a href="#核心技术分析" class="headerlink" title="核心技术分析"></a>核心技术分析</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">零信任模型的技术架构包括以下几个关键组件：</span><br><span class="line">1. 认证和授权：这是零信任模型的核心组件，用于验证用户和设备的身份，并授权它们访问特定的资源。</span><br><span class="line">这可以通过多种方式实现，例如多因素身份验证、单一登录、访问控制策略等。</span><br><span class="line">2. 网络分割：网络分割是将网络划分为多个安全区域的过程，每个区域都有自己的安全策略和访问控制规则。</span><br><span class="line">这可以通过虚拟专用网络（VPN）、软件定义网络（SDN）等技术实现。</span><br><span class="line">3. 实时监控和分析：零信任模型强调实时监控和分析，以便及时发现和应对安全威胁。</span><br><span class="line">这可以通过安全信息和事件管理（SIEM）系统、行为分析、威胁情报等技术实现。</span><br><span class="line">4. 应用程序和数据保护：应用程序和数据保护是保护敏感数据和应用程序的关键组件。这可以通过数据加密、访问控制、应用程序隔离等技术实现。</span><br><span class="line">5. 策略管理：策略管理是管理访问控制策略和安全策略的过程。这可以通过策略管理平台、自动化工具等技术实现。</span><br><span class="line">这些组件共同构成了零信任模型的技术架构，可以帮助企业实现更加安全、可控的网络环境。</span><br></pre></td></tr></table></figure>

<h2 id="七-从1到0熟悉一个系统的方法论"><a href="#七-从1到0熟悉一个系统的方法论" class="headerlink" title="七,从1到0熟悉一个系统的方法论"></a>七,从1到0熟悉一个系统的方法论</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">一,业务架构</span><br><span class="line">1,系统所在行业的情况是怎样？</span><br><span class="line">2,系统的目标用户是谁？比如是给公司高层做决策用？给运营或客服用？还是互联网用户用？</span><br><span class="line">3,平均有多少人在使用？高峰期有多少人在用？</span><br><span class="line">4,系统有什么业务价值？有哪些指标可以衡量系统业务价值？</span><br><span class="line">5,系统有哪些功能模块？</span><br><span class="line">6,系统有哪些领域概念？梳理下系统的领域模型；</span><br><span class="line">7,系统的关键业务流程有哪些？关键业务流程是怎样？</span><br><span class="line">8,系统的非功能性需求有哪些？如性能、质量、扩展性、安全性等；</span><br><span class="line">9,系统未来的发展规划是怎样？</span><br><span class="line">二,逻辑架构</span><br><span class="line">10,有哪些子系统或模块？系统之间是什么样的关系？</span><br><span class="line">11,对外上下游接口有哪些？对接人是谁？</span><br><span class="line">12,关键业务流程怎么实现的？用类图、序列图等方式表达出来。</span><br><span class="line">三,开发架构</span><br><span class="line">13,代码在哪？</span><br><span class="line">14,包怎么划分的？怎么分层？如 mvc、controller-service-dao；</span><br><span class="line">15,用了什么框架，如 ssh、dubbo；</span><br><span class="line">16,用了哪些工具包？如 apache commons、guava；</span><br><span class="line">17,用了哪些中间件？如 metaq、tair、schedulerX、Diamond；</span><br><span class="line">18,依赖哪些平台？如权限平台、流程引擎等。</span><br><span class="line">四,运行架构</span><br><span class="line">19,系统能支撑多少 qps？峰值 qps 多少？</span><br><span class="line">20,与上下游系统怎么交互的？rpc？http？同步还是异步？</span><br><span class="line">五,物理架构</span><br><span class="line">21,系统如何发布部署？有哪些部署环境？</span><br><span class="line">22,系统有多少台机器？</span><br><span class="line">23,系统部署怎么部署的？关注接入层，部署方式，如集群部署、分布式部署等</span><br><span class="line">24,有没有容器化？</span><br><span class="line">25,有没有多机房部署？</span><br><span class="line">六,数据架构</span><br><span class="line">26,数据存储在哪？用了什么数据库，如 oracle、mysql；</span><br><span class="line">27,梳理 E-R 图；</span><br><span class="line">28,数据量有多少？是否有分库分表？</span><br><span class="line">29,用了哪些 nosql 库？</span><br><span class="line">30,有哪些数据同步任务？</span><br><span class="line">31,大数据框架的使用情况如何？</span><br><span class="line">七,系统运维</span><br><span class="line">32,什么时间容易出问题？比如电商 双11，对系统的压力很大，这时候很容易出问题；</span><br><span class="line">33,对关键功能是否有监控？需要看系统有配置了哪些报警项，监控了哪些方面；</span><br><span class="line">34,出了问题怎么解决？日志在哪？是否有全链路跟踪？是否有一些紧急操作，比如开关配置、降级、限流配置；</span><br><span class="line">35,系统有哪些坑？找开发同学回顾历史问题，以免踩坑。通过同事总结的 case，或者与负责的产品、运营、技术与了解。系统总会有一些坑，需要把这些坑填上。历史代码经过多次迭代总会导致复杂度高（分支、嵌套、循环很多），存在设计漏洞，性能隐患等，很难维护，这些就需要我们去重构了。记住有一句话：填的坑越大，能力越大；</span><br><span class="line">36,运营、客服反馈的常见问题有哪些？</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/27/artiecure-reference/" data-id="cluj9jc9r00063j1me0kd8irs" data-title="架构方案汇总" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/05/27/architecture-file-writing/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          如何编写架构设计文档
        
      </div>
    </a>
  
  
    <a href="/2023/05/24/common-command-reference/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">common-command-reference</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IELTS/">IELTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/articture/">articture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/03/shell-study/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/04/03/shell-learn/">shell脚本</a>
          </li>
        
          <li>
            <a href="/2023/06/26/how-to-implement-zero-trust/">how to implement zero trust</a>
          </li>
        
          <li>
            <a href="/2023/06/13/news/">news</a>
          </li>
        
          <li>
            <a href="/2023/06/04/develop-mode/">设计模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>