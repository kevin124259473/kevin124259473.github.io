<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>common-command-reference | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="常见指令参考0,Java代码参考BizProcess 123456789@SuppressWarnings(value &#x3D; &amp;#123;&quot;rawtypes&quot;&amp;#125;)public interface BizProcess &amp;#123;    void doBizProcess(BizProcessContext context);&amp;#125;  BizProcessCont">
<meta property="og:type" content="article">
<meta property="og:title" content="common-command-reference">
<meta property="og:url" content="http://example.com/2023/05/24/common-command-reference/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="常见指令参考0,Java代码参考BizProcess 123456789@SuppressWarnings(value &#x3D; &amp;#123;&quot;rawtypes&quot;&amp;#125;)public interface BizProcess &amp;#123;    void doBizProcess(BizProcessContext context);&amp;#125;  BizProcessCont">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-05-24T10:44:40.000Z">
<meta property="article:modified_time" content="2024-04-03T03:30:41.835Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-common-command-reference" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/24/common-command-reference/" class="article-date">
  <time class="dt-published" datetime="2023-05-24T10:44:40.000Z" itemprop="datePublished">2023-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      common-command-reference
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="常见指令参考"><a href="#常见指令参考" class="headerlink" title="常见指令参考"></a>常见指令参考</h1><h2 id="0-Java代码参考"><a href="#0-Java代码参考" class="headerlink" title="0,Java代码参考"></a>0,Java代码参考</h2><p>BizProcess</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(value = &#123;&quot;rawtypes&quot;&#125;)</span><br><span class="line">public interface BizProcess &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    void doBizProcess(BizProcessContext context);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>BizProcessContext</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import com.google.common.collect.Maps;</span><br><span class="line">import lombok.Getter;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.Setter;</span><br><span class="line"></span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@Setter</span><br><span class="line">@Getter</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class BizProcessContext&lt;R, T&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private R request;</span><br><span class="line">    private T response;</span><br><span class="line">    private int code;</span><br><span class="line">    private String msg;</span><br><span class="line">    private Map&lt;String, Object&gt; parameterMap = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static final int Success = 200;</span><br><span class="line"></span><br><span class="line">    public static final int Error = 500;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static &lt;R,T&gt; BizProcessContext&lt;R,T&gt; newInstance() &#123;</span><br><span class="line">        return new BizProcessContext&lt;R,T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-k8s类别"><a href="#1-k8s类别" class="headerlink" title="1,k8s类别"></a>1,k8s类别</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete cm  `kubectl get cm -n flink-k8s |grep cluster|grep -v grep|awk &#x27;&#123;print $1&#125;&#x27;` -n flink-k8s &amp;&amp;  </span><br><span class="line"></span><br><span class="line">#批量rollout 指定的 sts</span><br><span class="line">kubectl rollout restart sts  flink-taskmanager flink-jobmanager  -n flink-k8s</span><br><span class="line"></span><br><span class="line">#强制删除指定pod</span><br><span class="line">kubectl delete pod  flink-taskmanager-0  --force --grace-period=0 -n flink-k8s</span><br><span class="line"></span><br><span class="line">#删除指定命名空间的数据</span><br><span class="line">kubectl  delete statefulset --all  -n insight-hr-v3 &amp;&amp; kubectl  delete deployment --all  -n insight-hr-v3 &amp;&amp; kubectl  delete service --all  -n insight-hr-v3 &amp;&amp; kubectl  delete ingress --all  -n insight-hr-v3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#通过关键字批量删除pod</span><br><span class="line">kubectl delete pod  `kubectl get pod -n demo-sit |grep $keyword|grep -v grep|awk &#x27;&#123;print $1&#125;&#x27;` -n demo-sit  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删除pod标签</span><br><span class="line">kebectl delete pod -l app=www -n kube-system</span><br><span class="line"></span><br><span class="line">#查看pod描述</span><br><span class="line">kubectl describe pod xxx -n kube-system</span><br><span class="line"></span><br><span class="line">参考文档</span><br><span class="line">https://cloud.tencent.com/developer/article/1140076</span><br><span class="line">https://segmentfault.com/a/1190000039966780</span><br></pre></td></tr></table></figure>



<h2 id="2-docker类别"><a href="#2-docker类别" class="headerlink" title="2,docker类别"></a>2,docker类别</h2><h3 id="docker-设置镜像加速"><a href="#docker-设置镜像加速" class="headerlink" title="docker 设置镜像加速"></a>docker 设置镜像加速</h3><p> &#x2F;etc&#x2F;docker&#x2F;daemon.json </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://hub-mirror.c.163.com&quot;,</span><br><span class="line">    &quot;https://mirror.baidubce.com&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#删除所有docker镜像</span><br><span class="line">docker rmi -f `docker images -aq`</span><br><span class="line"></span><br><span class="line">#打包指定的docker文件,并自定义tag</span><br><span class="line">docker build -f ./dockerfile-maven . -t harbor.demo.com//authenticate-service:dev-20230309-8-676345</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#docker安装mysql</span><br><span class="line">docker run -p 3306:3306 --restart=always -it   --name mysql8  -v /etc/mysql:/etc/mysql -v /var/log/mysql:/var/log/mysql -v /var/lib/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:8.0.26 --lower_case_table_names=1 --secure-file-priv=/var/lib/mysql</span><br><span class="line"></span><br><span class="line">ALTER USER root@localhost IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;;</span><br><span class="line">远程：ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;;</span><br><span class="line"></span><br><span class="line">#安装redis，</span><br><span class="line"></span><br><span class="line">docker run --restart=always  -p 6379:6379 --name redis  -d redis redis-server --requirepass &quot;AAAaaa1234&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#安装rabbitmq</span><br><span class="line"></span><br><span class="line">docker run -d --name rabbitmq3.7.7 --restart=always -p 5672:5672 -p 15672:15672 -v /opt/mq/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin rabbitmq:3.7.7-management</span><br><span class="line"></span><br><span class="line">#部署nexus</span><br><span class="line"></span><br><span class="line">mkdir -p /root/docker/nexus/data &amp;&amp; chown -R 200 /root/docker/nexus/data/ &amp;&amp;  docker run -d --name nexus3 -p 8081:8081 --restart always -v /root/docker/nexus/data:/nexus-data sonatype/nexus3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-mysql相关指令"><a href="#3-mysql相关指令" class="headerlink" title="3,mysql相关指令"></a>3,mysql相关指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#登录mysql 客户端</span><br><span class="line">mysql -h 192.1.3.1 -P 9030 -u root -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看mysql版本号</span><br><span class="line">select version();</span><br><span class="line"></span><br><span class="line"> select sleep(10);</span><br><span class="line"></span><br><span class="line">#创建用户,并授予相关权限</span><br><span class="line">CREATE USER &#x27;demo_cdc_&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;demo_cdc_@AAAaaa1234&#x27;;</span><br><span class="line">GRANT SELECT, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;demo_cdc_&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;demo_cdc_@AAAaaa1234&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-kafka相关指令"><a href="#4-kafka相关指令" class="headerlink" title="4,kafka相关指令"></a>4,kafka相关指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#kafka启动</span><br><span class="line">sudo /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties</span><br><span class="line"></span><br><span class="line">#zookeeper启动</span><br><span class="line">sudo /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties </span><br><span class="line"></span><br><span class="line">#kafka关闭</span><br><span class="line">sudo /opt/kafka/bin/kafka-server-stop.sh </span><br><span class="line"></span><br><span class="line">sudo /opt/kafka/bin/zookeeper-server-stop.sh &amp;&amp; sudo /opt/kafka/bin/kafka-server-stop.sh </span><br><span class="line"></span><br><span class="line">#批量关闭指令,并清除kafka数据,zk数据</span><br><span class="line">sudo kill -9 `ps -ef|grep /opt/kafka|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;` &amp;&amp; sudo chmod -R 777 /opt/ &amp;&amp; sudo rm -rf /opt/zookeeper/data/version*/* &amp;&amp; sudo rm -rf /opt/kafka/logs/*</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-flink相关指令"><a href="#5-flink相关指令" class="headerlink" title="5,flink相关指令"></a>5,flink相关指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#统计Flink任务个数</span><br><span class="line">/opt/flink/bin/flink list -m 172.4.8.10:31081|grep RUNNING |wc -l</span><br><span class="line"></span><br><span class="line">#通过命名行发布fink任务</span><br><span class="line">/opt/flink/bin/flink run -m 172.4.3.10:31081 -d  -s s3p://flink-storage/flink-checkpoints/f860fa4c80791e6aa7b81def598d7f2f/chk-4384 -c com.flink..job.kafka.to.Job   /home/www/lib/flink-job.jar  --username nacos --password nacos --namespace flink --serverAddr http://172.4.3.70:3000  --group DEFAULT_GROUP --dataId flink-demo</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="6-doris相关指令"><a href="#6-doris相关指令" class="headerlink" title="6,doris相关指令"></a>6,doris相关指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">--创建外表RESOURCE</span><br><span class="line">DROP RESOURCE &quot;sqlserver_external&quot;;</span><br><span class="line">CREATE EXTERNAL RESOURCE &quot;sqlserver_external&quot;</span><br><span class="line">PROPERTIES (</span><br><span class="line">    &quot;type&quot; = &quot;odbc_catalog&quot;,</span><br><span class="line">    &quot;user&quot; = &quot;sa&quot;,</span><br><span class="line">    &quot;odbc_type&quot; = &quot;sqlserver&quot;,</span><br><span class="line">    &quot;password&quot; = &quot;1qaz1qaz&quot;,</span><br><span class="line">    &quot;host&quot; = &quot;172.6.2.47&quot;,</span><br><span class="line">    &quot;driver&quot; = &quot;MSSQL ODBC 17.4 Driver&quot;,</span><br><span class="line">    &quot;port&quot; = &quot;1433&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">SET enable_insert_strict = true;</span><br><span class="line">SET query_timeout = 259200 ;</span><br><span class="line"></span><br><span class="line">#创建外表建表语句</span><br><span class="line">DROP TABLE IF EXISTS `EXT_MSSQL_Resume`;</span><br><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS `EXT_MSSQL_Resume` (</span><br><span class="line">`Id`  VARCHAR(64)     NOT NULL  ,</span><br><span class="line">  `op_ts` DATETIME</span><br><span class="line">) ENGINE=ODBC</span><br><span class="line">PROPERTIES (</span><br><span class="line">    &quot;odbc_catalog_resource&quot; = &quot;sqlserver_external&quot;,</span><br><span class="line">    &quot;database&quot; = &quot;demo&quot; ,</span><br><span class="line">    &quot;table&quot; = &quot;demo&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">--ddl</span><br><span class="line">DROP TABLE IF EXISTS `ODS_ResumeRelation`;</span><br><span class="line">CREATE TABLE IF NOT EXISTS `ODS_ResumeRelation`</span><br><span class="line">( </span><br><span class="line">	`Id`				varchar(48)		 NOT NULL,</span><br><span class="line">	`source` varchar(96) NOT NULL ,</span><br><span class="line"> 	`op_ts`  datetime NULL </span><br><span class="line"> ) UNIQUE KEY(`Id`,`source`) DISTRIBUTED BY HASH (`Id`,`source`) BUCKETS 32 </span><br><span class="line"> PROPERTIES(</span><br><span class="line"> &quot;in_memory&quot; = &quot;false&quot;,</span><br><span class="line">  &quot;replication_num&quot; = &quot;3&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="7-nginx相关设置"><a href="#7-nginx相关设置" class="headerlink" title="7,nginx相关设置"></a>7,nginx相关设置</h2><h3 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxy_connect_timeout</span><br><span class="line">proxy_read_timeout</span><br><span class="line">proxy_send_timeout</span><br><span class="line">keepalive_timeout </span><br><span class="line">client_header_timeout</span><br></pre></td></tr></table></figure>

<h3 id="搭建一个简单文件服务器"><a href="#搭建一个简单文件服务器" class="headerlink" title="搭建一个简单文件服务器"></a>搭建一个简单文件服务器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">                listen 8088; </span><br><span class="line">                server_name 172.16.9.91.1;</span><br><span class="line">                root /home/www/flink-nginx/; # 存放文件的目录 </span><br><span class="line">                location / &#123; </span><br><span class="line">                        autoindex on; # 索引 </span><br><span class="line">                        autoindex_exact_size on; # 显示文件大小 </span><br><span class="line">                        autoindex_localtime on; # 显示文件时间 </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="8-前端指令"><a href="#8-前端指令" class="headerlink" title="8,前端指令"></a>8,前端指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm install -g yarn</span><br><span class="line"></span><br><span class="line">set-executionpolicy remotesigned</span><br></pre></td></tr></table></figure>







<h2 id="9-windows端常见指令"><a href="#9-windows端常见指令" class="headerlink" title="9,windows端常见指令"></a>9,windows端常见指令</h2><h3 id="微信多开"><a href="#微信多开" class="headerlink" title="微信多开"></a>微信多开</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start &quot;&quot; &quot;D:\app\Tencent\WeChat\WeChat.exe&quot;</span><br><span class="line">start &quot;&quot; &quot;D:\app\Tencent\WeChat\WeChat.exe&quot;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>









<h2 id="99-常见综合指令"><a href="#99-常见综合指令" class="headerlink" title="99,常见综合指令"></a>99,常见综合指令</h2><h3 id="批量合并git分支代码"><a href="#批量合并git分支代码" class="headerlink" title="批量合并git分支代码"></a>批量合并git分支代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">home=&quot;/mnt/d/git&quot;</span><br><span class="line">host=&quot;gitlab.com&quot;</span><br><span class="line">module=&quot;demo&quot;</span><br><span class="line">service_array=( &quot;demo-starter&quot; &quot;gatewar-service&quot; &quot;file-service&quot; &quot;message-service&quot; &quot;identity-service&quot; &quot;authenticate-service&quot; &quot;system-service&quot; &quot;content-service&quot; &quot;recruit-service&quot; &quot;callback-service&quot; &quot;task-service&quot; &quot;seo-service&quot; &quot;front-sso&quot; &quot;front-admin&quot; &quot;front-organization&quot; &quot;front-mobile&quot;)</span><br><span class="line">length=$&#123;#service_array[*]&#125;</span><br><span class="line">dev=&quot;dev&quot;</span><br><span class="line">sit=&quot;sit&quot;</span><br><span class="line"></span><br><span class="line">for(( i=0;i&lt;length;i++)) do</span><br><span class="line">	cd $home</span><br><span class="line">	declare service=$&#123;service_array[i]&#125;</span><br><span class="line">	echo &quot;开始拉取 $service $dev 分支&quot; </span><br><span class="line">	git clone -b dev http://$host/$module/$service.git</span><br><span class="line">	echo &quot;拉取 完成&quot;</span><br><span class="line">	echo &quot;开始合并开发 $dev 分支到 $sit 分支&quot;</span><br><span class="line">	cd $home/$service   </span><br><span class="line">	echo &quot;当前目录 `pwd` &quot;</span><br><span class="line">	git merge origin/sit &amp;&amp; git branch sit &amp;&amp;   git push origin sit </span><br><span class="line">	echo &quot;合并 $service 完成&quot;	  </span><br><span class="line">done;</span><br></pre></td></tr></table></figure>

<h3 id="通过shell批量统计flink任务个数"><a href="#通过shell批量统计flink任务个数" class="headerlink" title="通过shell批量统计flink任务个数"></a>通过shell批量统计flink任务个数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">sites=&quot;ZJ SHEN GZ AH CQ DL FC GX HEB HEN HN HUB JS JX KC LG MACAO MS NB OES PT QD SC SD SX SY SZ TJ XA XH XJ XM YTRC BJRC AHKJ SH&quot;</span><br><span class="line">joins=&quot;-&quot;</span><br><span class="line">strM=&quot;SLF4J&quot;</span><br><span class="line">for site in $sites</span><br><span class="line">do</span><br><span class="line">	masterdata=&quot;AFOneMasterdataSqlserverToKafkaJob&quot;	</span><br><span class="line">	for r in `/opt/flink/bin/flink list -m 192.1.83.170:31081 |grep $site$joins$masterdata|wc -l `;do</span><br><span class="line">		rr=$(echo r | grep &quot;$&#123;strM&#125;&quot;)</span><br><span class="line">		if [[ &quot;$rr&quot; == &quot;&quot; ]]</span><br><span class="line">                then</span><br><span class="line">                echo &quot; $site$joins$masterdata  $r &quot;</span><br><span class="line">        fi</span><br><span class="line">	done		</span><br><span class="line">	finance=&quot;AFOneFinanceSqlserverToKafkaJob&quot;</span><br><span class="line">	for f in `/opt/flink/bin/flink list -m 192.1.83.170:31081 |grep $site$joins$finance|wc -l `;do</span><br><span class="line">		ff=$(echo f | grep &quot;$&#123;strM&#125;&quot;)</span><br><span class="line">		if [[ &quot;$ff&quot; == &quot;&quot; ]]</span><br><span class="line">                then</span><br><span class="line">                echo &quot; $site$joins$finance  $f &quot;</span><br><span class="line">        fi</span><br><span class="line">	done</span><br><span class="line">	data=&quot;AFOneDataSqlserverToKafkaJob&quot;</span><br><span class="line">	for d in `/opt/flink/bin/flink list -m 192.1.83.170:31081 |grep $site$joins$data|wc -l `;do</span><br><span class="line">		dd=$(echo d | grep &quot;$&#123;strM&#125;&quot;)</span><br><span class="line">		if [[ &quot;$dd&quot; == &quot;&quot; ]]</span><br><span class="line">                then</span><br><span class="line">                echo &quot; $site$joins$data  $d &quot;</span><br><span class="line">        fi</span><br><span class="line">	done	</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



<h3 id="通过shell批量停止flink任务"><a href="#通过shell批量停止flink任务" class="headerlink" title="通过shell批量停止flink任务"></a>通过shell批量停止flink任务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">strM=&quot;SLF4J&quot;</span><br><span class="line">for jobid in `/opt/flink/bin/flink list -m 192.1.3.70:31081|grep Job |awk &#x27;&#123;print $4 &#125;&#x27;`;do</span><br><span class="line">        result=$(echo $jobid | grep &quot;$&#123;strM&#125;&quot;)</span><br><span class="line">        if [[ &quot;$result&quot; == &quot;&quot; ]]</span><br><span class="line">                then</span><br><span class="line">                echo &quot; start stop $jobid *******************&quot;</span><br><span class="line">                /home/www/flink/bin/flink stop $jobid -m 192.1.3.70:31081</span><br><span class="line">                echo &quot; success stop $jobid success ********************&quot;</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="打包Java参考命令行"><a href="#打包Java参考命令行" class="headerlink" title="打包Java参考命令行"></a>打包Java参考命令行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if test ! -x &quot;$(command -v java)&quot;; then</span><br><span class="line">  echo &#x27;Error: java is not installed.&#x27; &gt;&amp;2</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if test ! -x &quot;$(command -v mvn)&quot;; then</span><br><span class="line">  echo &#x27;Error: Maven is not installed.&#x27; &gt;&amp;2</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line">if test $? -eq 0; then</span><br><span class="line">  echo &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 打包成功 &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot; &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 打包失败 &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="推镜像命令行"><a href="#推镜像命令行" class="headerlink" title="推镜像命令行"></a>推镜像命令行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">harbor=&#x27;harbor.com/&#x27;</span><br><span class="line">module=&#x27;demo/&#x27;</span><br><span class="line">appname=&#x27;demo-monitor-v1.0.0&#x27;-`date +%Y%m%d%H%M`</span><br><span class="line">image=$harbor$module$appname</span><br><span class="line">echo ---------------Build image...------------------</span><br><span class="line">echo</span><br><span class="line">   docker build -f ./dockerfile-flink . -t $image</span><br><span class="line">echo</span><br><span class="line">echo ---------------login harbor------------------</span><br><span class="line">   docker login -u demo -p AAAaaa1234 $harbor</span><br><span class="line">   </span><br><span class="line">echo</span><br><span class="line">echo ---------------push image------------------</span><br><span class="line">echo</span><br><span class="line">   docker push $image</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">echo ---------------logout harbor------------------</span><br><span class="line">echo</span><br><span class="line">   docker logout $harbor</span><br><span class="line">echo</span><br></pre></td></tr></table></figure>

<h3 id="jdk8统一dockerfile镜像-基于ubutu18-04"><a href="#jdk8统一dockerfile镜像-基于ubutu18-04" class="headerlink" title="jdk8统一dockerfile镜像,基于ubutu18.04"></a>jdk8统一dockerfile镜像,基于ubutu18.04</h3><p>打包指令参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f ./dockerfile-jdk8 . -t harbor.com/library/ubutu-jdk8:1.1.0</span><br></pre></td></tr></table></figure>

<p>dockerfile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:18.04</span><br><span class="line">COPY jdk.tar /opt/</span><br><span class="line">COPY sources.list /etc/apt/sources.list</span><br><span class="line">RUN mkdir /usr/lib/jvm</span><br><span class="line">RUN tar -xvf /opt/jdk.tar -C /usr/lib/jvm</span><br><span class="line">ENV TZ=Asia/Shanghai \</span><br><span class="line">    DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line">RUN apt update \</span><br><span class="line">    &amp;&amp; apt install -y tzdata \</span><br><span class="line">    &amp;&amp; ln -fs /usr/share/zoneinfo/$&#123;TZ&#125; /etc/localtime \</span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone \</span><br><span class="line">    &amp;&amp; dpkg-reconfigure --frontend noninteractive tzdata \</span><br><span class="line">    &amp;&amp; sed -i &quot;s@/archive.ubuntu.com/@/mirrors.163.com/@g&quot; /etc/apt/sources.list \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br><span class="line">    &amp;&amp; apt-get update --fix-missing -o Acquire::http::No-Cache=True \</span><br><span class="line">    &amp;&amp; apt-get install -y net-tools \ </span><br><span class="line">    &amp;&amp; apt-get install -y iputils-ping \</span><br><span class="line">    &amp;&amp; apt-get install -y curl \</span><br><span class="line">    &amp;&amp; apt-get install -y telnet </span><br><span class="line">ENV JAVA_HOME /usr/lib/jvm/jdk1.8.0_221</span><br><span class="line">ENV JRE_HOME $&#123;JAVA_HOME&#125;/jre</span><br><span class="line">ENV CLASSPATH .:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">ENV PATH $&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class="line">RUN java -version</span><br></pre></td></tr></table></figure>

<p>sources.list</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span><br><span class="line"># newer versions of the distribution.</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic main restricted</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic main restricted</span><br><span class="line"></span><br><span class="line">## Major bug fix updates produced after the final release of the</span><br><span class="line">## distribution.</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted</span><br><span class="line"></span><br><span class="line">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><br><span class="line">## team. Also, please note that software in universe WILL NOT receive any</span><br><span class="line">## review or updates from the Ubuntu security team.</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic universe</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic universe</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic-updates universe</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic-updates universe</span><br><span class="line"></span><br><span class="line">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><br><span class="line">## team, and may not be under a free licence. Please satisfy yourself as to</span><br><span class="line">## your rights to use the software. Also, please note that software in</span><br><span class="line">## multiverse WILL NOT receive any review or updates from the Ubuntu</span><br><span class="line">## security team.</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic multiverse</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic multiverse</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic-updates multiverse</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic-updates multiverse</span><br><span class="line"></span><br><span class="line">## N.B. software from this repository may not have been tested as</span><br><span class="line">## extensively as that contained in the main release, although it includes</span><br><span class="line">## newer versions of some applications which may provide useful features.</span><br><span class="line">## Also, please note that software in backports WILL NOT receive any review</span><br><span class="line">## or updates from the Ubuntu security team.</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"># deb-src http://archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">## Uncomment the following two lines to add software from Canonical&#x27;s</span><br><span class="line">## &#x27;partner&#x27; repository.</span><br><span class="line">## This software is not part of Ubuntu, but is offered by Canonical and the</span><br><span class="line">## respective vendors as a service to Ubuntu users.</span><br><span class="line"># deb http://archive.canonical.com/ubuntu bionic partner</span><br><span class="line"># deb-src http://archive.canonical.com/ubuntu bionic partner</span><br><span class="line"></span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ bionic-security main restricted</span><br><span class="line"># deb-src http://security.ubuntu.com/ubuntu/ bionic-security main restricted</span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ bionic-security universe</span><br><span class="line"># deb-src http://security.ubuntu.com/ubuntu/ bionic-security universe</span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ bionic-security multiverse</span><br><span class="line"># deb-src http://security.ubuntu.com/ubuntu/ bionic-security multiverse</span><br><span class="line"></span><br><span class="line">deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties</span><br><span class="line">deb http://archive.canonical.com/ubuntu xenial partner</span><br><span class="line">deb-src http://archive.canonical.com/ubuntu xenial partner</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse</span><br></pre></td></tr></table></figure>

<p>项目参考dockerfile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM harbor.com/library/ubutu-jdk8:1.1.0</span><br><span class="line">WORKDIR /opt/</span><br><span class="line">ENV SERVICE_VERSION=&quot;1.0.0&quot; </span><br><span class="line">ENV SERVICE_NAME=&#x27;recruit-service&#x27; </span><br><span class="line">ENV JAVA_OPTS=&#x27;-server -Xms2048m -Xmx2048m  -Xss1024k -XX:SurvivorRatio=8 -XX:+UseConcMarkSweepGC -Dfile.encoding=utf-8&#x27;</span><br><span class="line">COPY ./recruit-core/target/$&#123;SERVICE_NAME&#125;-$&#123;SERVICE_VERSION&#125;.jar /opt/</span><br><span class="line"># 启动jar</span><br><span class="line">CMD java  $&#123;JAVA_OPTS&#125; -jar /opt/$&#123;SERVICE_NAME&#125;-$&#123;SERVICE_VERSION&#125;.jar</span><br></pre></td></tr></table></figure>



<p>maven的配置settings.xml 文件参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span><br><span class="line">          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">          xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 本地存储路径 默认路径$&#123;user.home&#125;/.m2/repository --&gt;</span><br><span class="line">   &lt;!--  &lt;localRepository&gt;/Users/Nicholas/.m2/repository&lt;/localRepository&gt;  --&gt;</span><br><span class="line">   &lt;localRepository&gt;D:\java\repository&lt;/localRepository&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 表示Maven是否需要在离线模式下运行。</span><br><span class="line">         | 如果构建系统需要在离线模式下运行，则为true。</span><br><span class="line">         | 当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。</span><br><span class="line">         | 默认为false。</span><br><span class="line">  --&gt;</span><br><span class="line">    &lt;offline&gt;false&lt;/offline&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- Maven是否需要使用plugin-registry.xml文件来管理插件版本。</span><br><span class="line">         | 如果需要让Maven使用文件$&#123;user.home&#125;/.m2/plugin-registry.xml来管理插件版本，则设为true。默认为false。</span><br><span class="line">  --&gt;</span><br><span class="line">    &lt;usePluginRegistry&gt;false&lt;/usePluginRegistry&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 当插件的组织Id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。</span><br><span class="line">         | 该元素包含一个pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。</span><br><span class="line">         | 当我们使用某个插件，并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。</span><br><span class="line">         | 默认情况下该列表包含了org.apache.maven.plugins和org.codehaus.mojo</span><br><span class="line">  &lt;pluginGroups&gt;</span><br><span class="line">        plugin的组织Id（groupId）</span><br><span class="line">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span><br><span class="line">  &lt;/pluginGroups&gt;</span><br><span class="line">  --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 配置服务端的一些设置</span><br><span class="line">			| 一些设置如安全证书不应该和pom.xml一起分发。</span><br><span class="line">			| 这种类型的信息应该存在于构建服务器上的settings.xml文件中。</span><br><span class="line">			| settings.xml中server元素下id的值必须与POM中repository或snapshotRepository下id的值完全一致。将认证信息放到settings下而非POM中，是因为POM往往是它人可见的，而settings.xml是本地的 --&gt;</span><br><span class="line">	&lt;servers&gt;</span><br><span class="line">		&lt;server&gt;</span><br><span class="line">			&lt;id&gt;example-releases&lt;/id&gt;</span><br><span class="line">			&lt;username&gt;upload&lt;/username&gt;</span><br><span class="line">			&lt;password&gt;upload&lt;/password&gt;</span><br><span class="line">		&lt;/server&gt;</span><br><span class="line">		&lt;server&gt;</span><br><span class="line">			&lt;id&gt;example-group&lt;/id&gt;</span><br><span class="line">			&lt;username&gt;upload&lt;/username&gt;</span><br><span class="line">			&lt;password&gt;upload&lt;/password&gt;</span><br><span class="line">		&lt;/server&gt;</span><br><span class="line">	&lt;/servers&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;profiles&gt;</span><br><span class="line">		&lt;profile&gt;</span><br><span class="line">			&lt;id&gt;examplesh&lt;/id&gt;</span><br><span class="line">			&lt;properties&gt;</span><br><span class="line">				&lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">				&lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">				&lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;</span><br><span class="line">			&lt;/properties&gt;</span><br><span class="line">			&lt;repositories&gt;</span><br><span class="line">				&lt;repository&gt;</span><br><span class="line">					&lt;id&gt;examplesh&lt;/id&gt;</span><br><span class="line">					&lt;url&gt;http://nexus.examplesh.com/repository/maven-public/&lt;/url&gt;</span><br><span class="line">					&lt;snapshots&gt;</span><br><span class="line">                        &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</span><br><span class="line">                    &lt;/snapshots&gt;</span><br><span class="line">					&lt;releases&gt;</span><br><span class="line">						&lt;!--支持从此仓库下载release版本--&gt;</span><br><span class="line">						&lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">						&lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</span><br><span class="line">					&lt;/releases&gt;</span><br><span class="line">				&lt;/repository&gt;</span><br><span class="line">			&lt;/repositories&gt;</span><br><span class="line"></span><br><span class="line">				&lt;!--  插件仓库 --&gt;</span><br><span class="line">			&lt;pluginRepositories&gt;</span><br><span class="line">				&lt;pluginRepository&gt;</span><br><span class="line">					&lt;id&gt;examplesh-plugin&lt;/id&gt;</span><br><span class="line">					&lt;url&gt;http://nexus.examplesh.com/repository/maven-public/&lt;/url&gt;</span><br><span class="line">					&lt;releases&gt;</span><br><span class="line">						&lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</span><br><span class="line">					&lt;/releases&gt;</span><br><span class="line">					&lt;snapshots&gt;</span><br><span class="line">						&lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</span><br><span class="line">					&lt;/snapshots&gt;</span><br><span class="line">				&lt;/pluginRepository&gt;</span><br><span class="line">			&lt;/pluginRepositories&gt;</span><br><span class="line">		&lt;/profile&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;profile&gt;</span><br><span class="line">            &lt;id&gt;example&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;skipTests&gt;true&lt;/skipTests&gt;</span><br><span class="line">                &lt;!--设置仓库上传地址--&gt;</span><br><span class="line">                &lt;nexus.snapshots.repository&gt;http://nexus.exampleit.com.cn/repository/example-snapshot</span><br><span class="line">                &lt;/nexus.snapshots.repository&gt;</span><br><span class="line">                &lt;nexus.releases.repository&gt;http://nexus.exampleit.com.cn/repository/example-release</span><br><span class="line">                &lt;/nexus.releases.repository&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">            &lt;pluginRepositories&gt;</span><br><span class="line">                &lt;pluginRepository&gt;</span><br><span class="line">                    &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class="line">                    &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class="line">                    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span><br><span class="line">                &lt;/pluginRepository&gt;</span><br><span class="line">            &lt;/pluginRepositories&gt;</span><br><span class="line"></span><br><span class="line">            &lt;repositories&gt;</span><br><span class="line">                &lt;repository&gt;</span><br><span class="line">                    &lt;id&gt;example-group&lt;/id&gt;</span><br><span class="line">                    &lt;name&gt;example-group&lt;/name&gt;</span><br><span class="line">                    &lt;url&gt;http://nexus.exampleit.com.cn/repository/example-group/&lt;/url&gt;</span><br><span class="line">                    &lt;snapshots&gt;</span><br><span class="line">                        &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</span><br><span class="line">                    &lt;/snapshots&gt;</span><br><span class="line">                    &lt;releases&gt;</span><br><span class="line">                        &lt;enabled&gt;true&lt;/enabled&gt;</span><br><span class="line">                    &lt;/releases&gt;</span><br><span class="line">                &lt;/repository&gt;</span><br><span class="line">            &lt;/repositories&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line">	&lt;/profiles&gt;</span><br><span class="line">	&lt;activeProfiles&gt;  </span><br><span class="line">		&lt;activeProfile&gt;example&lt;/activeProfile&gt;</span><br><span class="line">	&lt;/activeProfiles&gt;</span><br><span class="line"></span><br><span class="line">&lt;/settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>











<h3 id="flink1-16-打包dockerfile"><a href="#flink1-16-打包dockerfile" class="headerlink" title="flink1.16 打包dockerfile"></a>flink1.16 打包dockerfile</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM flink:1.16.2-scala_2.12-java8</span><br><span class="line"></span><br><span class="line">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">RUN echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line">RUN sed -i &#x27;s/^jdk.tls.disabledAlgorithms=.*/jdk.tls.disabledAlgorithms=RC4, DES, MD5withRSA, \\/&#x27; /opt/java/openjdk/lib/security/java.security</span><br><span class="line">RUN sed -ri -e &#x27;s/(MinProtocol\s*=\s*)TLSv1\.2/\1None/&#x27; /etc/ssl/openssl.cnf \</span><br><span class="line">    &amp;&amp; sed -ri -e &#x27;s/(CipherString\s*=\s*DEFAULT)@SECLEVEL=2/\1/&#x27; /etc/ssl/openssl.cnf</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/flink</span><br><span class="line">RUN ls -l </span><br><span class="line">RUN mkdir ./plugins/s3-fs-presto &amp;&amp; chown flink:flink -R ./plugins/s3-fs-presto &amp;&amp; cp ./opt/flink-s3-fs-presto-1.16.2.jar ./plugins/s3-fs-presto/ </span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h3 id="k8s-service类别"><a href="#k8s-service类别" class="headerlink" title="k8s service类别"></a>k8s service类别</h3><h4 id="ExternalName"><a href="#ExternalName" class="headerlink" title="ExternalName"></a>ExternalName</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: base-db</span><br><span class="line">  namespace: -sit</span><br><span class="line">  labels:</span><br><span class="line">    app: -base-db</span><br><span class="line">spec:</span><br><span class="line">  type: ExternalName</span><br><span class="line">  externalName: -base-db.dev.svc.cluster.local  </span><br><span class="line">  ports:</span><br><span class="line">  - port: 3306</span><br><span class="line">    targetPort: 3306</span><br><span class="line">    protocol: TCP</span><br><span class="line">  selector:</span><br><span class="line">    app: -base-db</span><br></pre></td></tr></table></figure>

<h4 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kind: Endpoints</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: kafka</span><br><span class="line">  namespace: ciicsh-zhaopin-sit</span><br><span class="line">subsets:</span><br><span class="line">  - addresses:</span><br><span class="line">      - ip: 172.16.112.91 </span><br><span class="line">    ports:</span><br><span class="line">      - port: 9092</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: kafka</span><br><span class="line">  namespace: ciicsh-zhaopin-sit  </span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 9092</span><br><span class="line">      targetPort: 9092</span><br></pre></td></tr></table></figure>

<h3 id="k8s创建nacos"><a href="#k8s创建nacos" class="headerlink" title="k8s创建nacos"></a>k8s创建nacos</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">kind: Endpoints</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql</span><br><span class="line">  namespace: dev</span><br><span class="line">subsets:</span><br><span class="line">  - addresses:</span><br><span class="line">      - ip: 172.16.9.91</span><br><span class="line">    ports:</span><br><span class="line">      - port: 3306</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql</span><br><span class="line">  namespace: dev  </span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 3306</span><br><span class="line">      targetPort: 3306  </span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: nacos</span><br><span class="line">  annotations:</span><br><span class="line">    kubernetes.io/ingress.class: &quot;nginx&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/client-body-buffer-size: &quot;100m&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/keepalive-timeout: &quot;360&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-body-size: &quot;50m&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;360&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;360&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;360&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/upstream-keepalive-timeout: &quot;360&quot;</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: nacos-dev.tstk8s.sh.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: &quot;/&quot;</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: nacos</span><br><span class="line">          servicePort: 8848 </span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nacos</span><br><span class="line">  namespace: dev</span><br><span class="line">  labels:</span><br><span class="line">    app: nacos</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 8848</span><br><span class="line">      name: server</span><br><span class="line">      targetPort: 8848</span><br><span class="line">      nodePort: 31009</span><br><span class="line">    - port: 9848</span><br><span class="line">      name: client-rpc</span><br><span class="line">      targetPort: 9848</span><br><span class="line">    - port: 9849</span><br><span class="line">      name: raft-rpc</span><br><span class="line">      targetPort: 9849</span><br><span class="line">      ## 兼容1.4.x版本的选举端口</span><br><span class="line">    - port: 7848</span><br><span class="line">      name: old-raft-rpc</span><br><span class="line">      targetPort: 7848</span><br><span class="line">  selector:</span><br><span class="line">    app: nacos</span><br><span class="line">---</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: nacos-cm</span><br><span class="line">  namespace: dev</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/managed-by: Helm</span><br><span class="line">  annotations:</span><br><span class="line">    meta.helm.sh/release-name: nacos</span><br><span class="line">    meta.helm.sh/release-namespace: nacos</span><br><span class="line">data:</span><br><span class="line">  mysql.host: mysql</span><br><span class="line">  mysql.db.name: _base_nacos</span><br><span class="line">  mysql.param: &gt;-</span><br><span class="line">    characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useSSL=false</span><br><span class="line">  mysql.password: root</span><br><span class="line">  mysql.port: &#x27;3306&#x27;</span><br><span class="line">  mysql.user: root</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: nacos</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  serviceName: nacos</span><br><span class="line">  # 单机模式设置成1，集群模式设置成3</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nacos</span><br><span class="line">      annotations:</span><br><span class="line">        pod.alpha.kubernetes.io/initialized: &quot;true&quot;</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">        - name: data</span><br><span class="line">          emptyDir: &#123;&#125;</span><br><span class="line">      containers:</span><br><span class="line">        - name: nacos</span><br><span class="line">          imagePullPolicy: Always</span><br><span class="line">          image: harbor.sh.com/base/nacos-server:1.4.1</span><br><span class="line">          resources:</span><br><span class="line">            requests:</span><br><span class="line">              memory: &quot;256Mi&quot;</span><br><span class="line">              cpu: &quot;250m&quot;</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: data</span><br><span class="line">              mountPath: /home/nacos/plugins/peer-finder</span><br><span class="line">              subPath: peer-finder</span><br><span class="line">            - name: data</span><br><span class="line">              mountPath: /home/nacos/data</span><br><span class="line">              subPath: data</span><br><span class="line">            - name: data</span><br><span class="line">              mountPath: /home/nacos/logs</span><br><span class="line">              subPath: logs</span><br><span class="line">          terminationMessagePath: /dev/termination-log</span><br><span class="line">          terminationMessagePolicy: File</span><br><span class="line">          imagePullPolicy: IfNotPresent                            </span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8848</span><br><span class="line">              name: client</span><br><span class="line">            - containerPort: 9848</span><br><span class="line">              name: client-rpc</span><br><span class="line">            - containerPort: 9849</span><br><span class="line">              name: raft-rpc</span><br><span class="line">            - containerPort: 7848</span><br><span class="line">              name: old-raft-rpc</span><br><span class="line">          env:</span><br><span class="line">            - name: NACOS_REPLICAS</span><br><span class="line">              # 单机模式设置成1，集群模式设置成3</span><br><span class="line">              value: &quot;1&quot;</span><br><span class="line">            - name: MYSQL_SERVICE_HOST # 添加 mysql 访问地址的环境变量</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.host</span><br><span class="line">            - name: MYSQL_SERVICE_DB_NAME</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.db.name</span><br><span class="line">            - name: MYSQL_SERVICE_PORT</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.port</span><br><span class="line">            - name: MYSQL_SERVICE_USER</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.user</span><br><span class="line">            - name: MYSQL_SERVICE_PASSWORD</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.password</span><br><span class="line">            - name: NACOS_SERVER_PORT</span><br><span class="line">              value: &quot;8848&quot;</span><br><span class="line">            - name: NACOS_APPLICATION_PORT</span><br><span class="line">              value: &quot;8848&quot;</span><br><span class="line">            - name: PREFER_HOST_MODE</span><br><span class="line">              value: &quot;hostname&quot;</span><br><span class="line">            - name: MYSQL_SERVICE_DB_PARAM</span><br><span class="line">              valueFrom:</span><br><span class="line">                configMapKeyRef:</span><br><span class="line">                  name: nacos-cm</span><br><span class="line">                  key: mysql.param              </span><br><span class="line">            #- name: NACOS_SERVERS</span><br><span class="line">              # 单机模式设置成nacos-0.xxxx,集群模式要添加：nacos-1.xxxx和nacos-2.xxxxx</span><br><span class="line">              #value: &quot;nacos-0.nacos.default.svc.cluster.local:8848 nacos-1.nacos.default.svc.cluster.local:8848 nacos-2.nacos.default.svc.cluster.local:8848&quot;</span><br><span class="line">            - name: MODE</span><br><span class="line">              # 单机部署，value: &quot;standalone&quot; </span><br><span class="line">              # 集群部署，value: &quot;cluster&quot;    </span><br><span class="line">              value: &quot;standalone&quot;  </span><br><span class="line">            - name: SPRING_DATASOURCE_PLATFORM</span><br><span class="line">              value: mysql  </span><br><span class="line">            - name: NACOS_AUTH_ENABLE</span><br><span class="line">              value: &#x27;false&#x27;        </span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nacos</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/24/common-command-reference/" data-id="cluj9jc9u00093j1m6skj44jo" data-title="common-command-reference" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/05/27/artiecure-reference/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          架构方案汇总
        
      </div>
    </a>
  
  
    <a href="/2023/05/20/how-to-read-source-code/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Redis 源码阅读</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IELTS/">IELTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/articture/">articture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/03/develop-plan/">开发计划</a>
          </li>
        
          <li>
            <a href="/2024/04/03/shell-study/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/04/03/shell-learn/">shell脚本</a>
          </li>
        
          <li>
            <a href="/2023/06/26/how-to-implement-zero-trust/">how to implement zero trust</a>
          </li>
        
          <li>
            <a href="/2023/06/13/news/">news</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>